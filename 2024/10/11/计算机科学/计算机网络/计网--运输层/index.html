



<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#FFF">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/cyy.png">

<link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">


<link rel="alternate" type="application/rss+xml" title="眨眼的小星玥" href="http://www.luckycyyyy.top/rss.xml" />
<link rel="alternate" type="application/atom+xml" title="眨眼的小星玥" href="http://www.luckycyyyy.top/atom.xml" />
<link rel="alternate" type="application/json" title="眨眼的小星玥" href="http://www.luckycyyyy.top/feed.json" />

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="/css/app.css?v=0.2.5">

  
  <meta name="keywords" content="计网" />


<link rel="canonical" href="http://www.luckycyyyy.top/2024/10/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E8%BF%90%E8%BE%93%E5%B1%82/">



  <title>
运输层 - 计算机网络 - 计算机科学 |
Aurijun = 眨眼的小星玥 = 世间风物论自由，喜一生我有，共四海丰收</title>
<meta name="generator" content="Hexo 7.2.0"></head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div id="loading">
    <div class="cat">
      <div class="body"></div>
      <div class="head">
        <div class="face"></div>
      </div>
      <div class="foot">
        <div class="tummy-end"></div>
        <div class="bottom"></div>
        <div class="legs left"></div>
        <div class="legs right"></div>
      </div>
      <div class="paw">
        <div class="hands left"></div>
        <div class="hands right"></div>
      </div>
    </div>
  </div>
  <div id="container">
    <header id="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="inner">
        <div id="brand">
          <div class="pjax">
          
  <h1 itemprop="name headline">运输层
  </h1>
  
<div class="meta">
  <span class="item" title="创建时间：2024-10-11 12:48:23">
    <span class="icon">
      <i class="ic i-calendar"></i>
    </span>
    <span class="text">发表于</span>
    <time itemprop="dateCreated datePublished" datetime="2024-10-11T12:48:23+08:00">2024-10-11</time>
  </span>
  <span class="item" title="本文字数">
    <span class="icon">
      <i class="ic i-pen"></i>
    </span>
    <span class="text">本文字数</span>
    <span>6.5k</span>
    <span class="text">字</span>
  </span>
  <span class="item" title="阅读时长">
    <span class="icon">
      <i class="ic i-clock"></i>
    </span>
    <span class="text">阅读时长</span>
    <span>6 分钟</span>
  </span>
</div>


          </div>
        </div>
        <nav id="nav">
  <div class="inner">
    <div class="toggle">
      <div class="lines" aria-label="切换导航栏">
        <span class="line"></span>
        <span class="line"></span>
        <span class="line"></span>
      </div>
    </div>
    <ul class="menu">
      <li class="item title"><a href="/" rel="start">Aurijun</a></li>
    </ul>
    <ul class="right">
      <li class="item theme">
        <i class="ic i-sun"></i>
      </li>
      <li class="item search">
        <i class="ic i-search"></i>
      </li>
    </ul>
  </div>
</nav>

      </div>
      <div id="imgs" class="pjax">
        <ul>
          <li class="item" data-background-image="https://dlink.host/wx3.sinaimg.cn/large/007CYURoly8hzl490mezxj31hc0u0tm1.jpg"></li>
          <li class="item" data-background-image="https://dlink.host/wx2.sinaimg.cn/large/007CYURoly8hzm7t6zb08j31hc0u078f.jpg"></li>
          <li class="item" data-background-image="https://s21.ax1x.com/2025/03/25/pEDVtP0.png"></li>
          <li class="item" data-background-image="https://s21.ax1x.com/2025/03/25/pEDVJ5q.png"></li>
          <li class="item" data-background-image="https://haowallpaper.com/link/common/file/previewFileImg/16715485889940864"></li>
          <li class="item" data-background-image="https://s21.ax1x.com/2025/03/22/pE06UBD.jpg"></li>
        </ul>
      </div>
    </header>
    <div id="waves">
      <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
        <defs>
          <path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z" />
        </defs>
        <g class="parallax">
          <use xlink:href="#gentle-wave" x="48" y="0" />
          <use xlink:href="#gentle-wave" x="48" y="3" />
          <use xlink:href="#gentle-wave" x="48" y="5" />
          <use xlink:href="#gentle-wave" x="48" y="7" />
        </g>
      </svg>
    </div>
    <main>
      <div class="inner">
        <div id="main" class="pjax">
          
  <div class="article wrap">
    
<div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList">
<i class="ic i-home"></i>
<span><a href="/">首页</a></span><i class="ic i-angle-right"></i>
<span  itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/" itemprop="item" rel="index" title="分类于 计算机科学"><span itemprop="name">计算机科学</span></a>
<meta itemprop="position" content="1" /></span>
<i class="ic i-angle-right"></i>
<span  class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="item" rel="index" title="分类于 计算机网络"><span itemprop="name">计算机网络</span></a>
<meta itemprop="position" content="2" /></span>
</div>

    <article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN">
  <link itemprop="mainEntityOfPage" href="http://www.luckycyyyy.top/2024/10/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E8%BF%90%E8%BE%93%E5%B1%82/">

  <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="image" content="/images/cyy.png">
    <meta itemprop="name" content="Aurijun">
    <meta itemprop="description" content="世间风物论自由，喜一生我有，共四海丰收, 小星玥，要努力学习呀！">
  </span>

  <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="眨眼的小星玥">
  </span>

  <div class="body md" itemprop="articleBody">
    

    <h1 id="概述运输层服务"><a class="markdownIt-Anchor" href="#概述运输层服务">#</a> 概述运输层服务</h1>
<p>运输层为运行在<strong>不同</strong>主机上的<strong>应用进程</strong>提供直接的通信服务。</p>
<p>运输层协议是在<strong>端系统</strong>中而不是在路由器中实现的。具体实现过程如下：</p>
<ol>
<li>
<p><strong>发送端</strong>：运输层将从发送应用程序进程接收到的报文转换成运输层分组，即运输层报文段（先将应用报文划分成小块，再加上运输层首部）。运输层将这些报文段发送给网络层，网络层将其封装成网络分组（即数据报）并向目的地发送。<strong>网络路由器</strong>只作用于数据报的<strong>网络层字段</strong>，而<strong>不</strong>检查封装在该数据报运输层报文段的字段。</p>
</li>
<li>
<p><strong>接收端</strong>：网络层从数据报中提取运输层报文段并将该报文段向上交给运输层。</p>
</li>
</ol>
<h2 id="运输层和网络层的关系"><a class="markdownIt-Anchor" href="#运输层和网络层的关系">#</a> 运输层和网络层的关系</h2>
<p>网络层提供<strong>主机</strong>间的逻辑通信，运输层为运行在<strong>不同主机上的进程</strong>之间提供逻辑通信。</p>
<p>在端系统中运输层协议将来自应用进程的报文<strong>移动到网络边缘</strong>（即网络层）。</p>
<p>计算机网络中可以安排多种运输层协议，每种协议为应用程序提供<strong>不同</strong>的服务模型。</p>
<p>运输层协议能够提供的服务尝尝<strong>受制于</strong>底层网络层协议的服务模型。</p>
<p>即使网络层不能保证运输层报文段的机密性，运输协议也能使用加密来确保应用程序报文不被入侵者读取。</p>
<h2 id="运输层概述"><a class="markdownIt-Anchor" href="#运输层概述">#</a> 运输层概述</h2>
<p>UDP（用户数据报协议）：提供不可靠、无连接的服务，只能提供数据交付和差错检查。</p>
<p>TCP（传输控制协议）：提供可靠的、面向连接的服务。</p>
<h1 id="多路复用与多路分解"><a class="markdownIt-Anchor" href="#多路复用与多路分解">#</a> 多路复用与多路分解</h1>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191132567.png" alt=""></p>
<p>一个进程有一个或多个套接字（ip + 端口号），接收主机怎样将一个到达的运输层报文段定向到适当的套接字？</p>
<p><strong>多路分解</strong>：在接收端，运输层检查这些字段，标识出接收套接字，进而将报文段定向到该套接字。将运输层报文段中的数据交付到正确的套接字的工作称为多路分解。</p>
<p><strong>多路复用</strong>：在源主机从不同套接字中收集数据块，并为每个数据块封装上首部信息从而生成报文段，然后将报文段传递到网络层，这所有的工作称为多路复用。</p>
<p>运输层报文段的结构：</p>
<img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111333486.png" style="zoom: 50%;" />
<p>应用程序的客户端让运输层自动地分配端口号，服务器端则分配一个特定的端口号。</p>
<p>UDP 套接字由一个<strong>二元组</strong>全面标识，该二元组包含一个目的 ip 和一个目的端口号。</p>
<p>TCP 套接字由一个<strong>四元组</strong>全面标识，该四元组包含源 ip 地址、源端口号、目的 ip 地址、目的端口号。</p>
<h1 id="udp和tcp对比"><a class="markdownIt-Anchor" href="#udp和tcp对比">#</a> UDP 和 TCP 对比</h1>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191146630.png" alt=""></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191148024.png" alt=""></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191149976.png" alt=""></p>
<h1 id="无连接运输udp"><a class="markdownIt-Anchor" href="#无连接运输udp">#</a> 无连接运输：UDP</h1>
<p><strong>UDP 优点：</strong></p>
<ol>
<li>关于发送什么数据以及何时发送的应用层控制更为精细（没有拥塞控制机制），按需随时发送。</li>
<li>无需建立连接，不会引入建立连接的时延。</li>
<li>无连接状态，TCP 维护连接状态需要维护包括接收和发送缓存、拥塞控制参数、序号与确认号的参数，而 UDP 不需要，因此当应用程序运行在 UDP 上，某些专门用于某种特定应用的服务器一般都能支持更多的活跃用户。</li>
<li>首部开销小。UDP：8Byte，TCP：20Byte</li>
</ol>
<p>但是因为 UDP 没有拥塞控制，所以如果网络进入拥塞状态，UDP 的<strong>高丢包率</strong>会引起<strong> TCP</strong> 的发送方大大<strong>减小</strong>它们的<strong>速率</strong>。</p>
<p><strong>采用 UDP 的应用：</strong></p>
<ol>
<li>远程文件服务器（NFS）</li>
<li>流式多媒体</li>
<li>因特网电话</li>
<li>网络管理（SNMP）</li>
<li>选路协议（RIP）</li>
<li>域名解析（NDS）</li>
</ol>
<p><strong>UDP 报文段：</strong></p>
<img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111413149.jpg" style="zoom: 25%;" />
<p>UDP 首部有 4 个字段，每个字段由两个字节组成。</p>
<p>长度：首部 + 数据。</p>
<p>接收方通过检验和检查该报文段是否出现问题。</p>
<p><strong>UDP 检验和</strong>：</p>
<ol>
<li>将报文段切成 16bit 的数据</li>
<li>对报文段中所有 16 比特字的和进行反码运算，求和时任何溢出都被回卷（进的位回到个位）</li>
<li>因为原码 + 反码 = 全 1，所以检查是否为全 1 即可</li>
</ol>
<h1 id="可靠数据传输原理"><a class="markdownIt-Anchor" href="#可靠数据传输原理">#</a> 可靠数据传输原理</h1>
<blockquote>
<p>rdt1.0~rdt3.0 都使用停等协议</p>
<p>停等协议：发送方发送数据后等待接收方的响应</p>
</blockquote>
<h2 id="经完全可靠的信道的可靠信息传输rdt10"><a class="markdownIt-Anchor" href="#经完全可靠的信道的可靠信息传输rdt10">#</a> 经完全可靠的信道的可靠信息传输：rdt1.0</h2>
<p>底层信道完全可靠。</p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111431075.png" alt=""></p>
<p>有限状态机（FSM）</p>
<p>因为底层信道完全可靠，所以接收方不需要反馈信息给发送方。</p>
<h2 id="经具有比特差错信道的可靠数据传输rdt2x"><a class="markdownIt-Anchor" href="#经具有比特差错信道的可靠数据传输rdt2x">#</a> 经具有比特差错信道的可靠数据传输：rdt2.x</h2>
<blockquote>
<p>2.x 解决了流控问题</p>
</blockquote>
<p>底层信道分组中的比特可能受损。</p>
<h3 id="20-发送的数据受损"><a class="markdownIt-Anchor" href="#20-发送的数据受损">#</a> 2.0 发送的数据受损</h3>
<p>采用自动重传请求协议（ARQ），进行差错检测、接收方反馈（ACK/NAK）、重传</p>
<p>重传：使用缓冲区缓存已发出但未收到反馈的报文段</p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111441861.png" alt=""></p>
<h3 id="21-acknak受损"><a class="markdownIt-Anchor" href="#21-acknak受损">#</a> 2.1 ACK/NAK 受损</h3>
<p>发送方不知道接收方的情况，只能重传。</p>
<p>但是可能导致接收方的重复接收，那么接收方怎么知道收到的分组是新的还是一次重传？于是引入分组编号。</p>
<p>因为只有两种状态：新的分组或者重传，所以只需要编号 0 和 1。如果收到的分组和上一次收到的分组编号一致，说明是一次重传</p>
<h3 id="22-使用一个无nak的可靠数据传输协议"><a class="markdownIt-Anchor" href="#22-使用一个无nak的可靠数据传输协议">#</a> 2.2 使用一个无 NAK 的可靠数据传输协议</h3>
<p><strong>重复的 ACK = NAK</strong>：不发送 NAK，而是对上次正确接收的分组发送一个 ACK；即当发送方接收到冗余的 ACK，就知道接收方没有正确接收到跟在被确认两次的分组后的分组。</p>
<h2 id="经具有比特差错的丢包信道的可靠数据传输rdt30"><a class="markdownIt-Anchor" href="#经具有比特差错的丢包信道的可靠数据传输rdt30">#</a> 经具有比特差错的丢包信道的可靠数据传输：rdt3.0</h2>
<p>除了比特受损外，底层信道还会丢包。</p>
<p>设置倒计数定时器，面对超时的数据进行重传。如果数据本身未丢失只是超时了，就会导致冗余数据分组，直接忽略即可。</p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111509160.jpg" alt=""></p>
<h2 id="流水线可靠数据传输协议"><a class="markdownIt-Anchor" href="#流水线可靠数据传输协议">#</a> 流水线可靠数据传输协议</h2>
<p>因为 rdt3.0 使用的是停等协议，所以效率较低，于是使用流水线技术。</p>
<p>允许发送方发送多个分组并无需等待确认</p>
<ol>
<li>原本的两个序号（0,1）不够用，必须增大序号范围</li>
<li>发送方最低限度应能缓存那些已发送但未被确认的分组</li>
<li>接收方需缓存那些已经正确接收的分组</li>
</ol>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111519103.png" alt=""></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410111522171.png" alt=""></p>
<p>当流水线技术中丢失一个分组，差错恢复有两种方法：<strong>回退 N 步</strong>和<strong>选择重传</strong>。</p>
<h3 id="回退n步协议gbn"><a class="markdownIt-Anchor" href="#回退n步协议gbn">#</a> 回退 N 步协议（GBN）</h3>
<p><strong>累计确认 ACK (n)</strong>：接收方对序号 n 之前包括 n 在内的所有分组进行确认</p>
<p><strong>超时事件</strong>：发送方重传所有已发送但未被确认的分组，发送方只使用一个定时器，如果收到一个 ACK 但是仍有已发送但未被确认的分组，则定时器被重新启动。</p>
<p><strong>分组失序</strong>：接收方无缓存，所以直接丢弃，重发按序到达的最高序号后面的分组</p>
<p><strong>滑动窗口大小</strong>：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mstyle mathcolor="red"><mrow><mtext>发送端</mtext><mo>≤</mo><msup><mn>2</mn><mi>k</mi></msup><mo>−</mo><mn>1</mn><mtext>，接收端</mtext><mo>=</mo><mn>1</mn></mrow></mstyle></mrow><annotation encoding="application/x-tex">\color{red}{发送端\leq 2^{k}-1，接收端=1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.985078em;vertical-align:-0.13597em;"></span><span class="mord" style="color:red;"><span class="mord cjk_fallback" style="color:red;">发</span><span class="mord cjk_fallback" style="color:red;">送</span><span class="mord cjk_fallback" style="color:red;">端</span><span class="mspace" style="color:red;margin-right:0.2777777777777778em;"></span><span class="mrel" style="color:red;">≤</span><span class="mspace" style="color:red;margin-right:0.2777777777777778em;"></span><span class="mord" style="color:red;"><span class="mord" style="color:red;">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.849108em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight" style="color:red;"><span class="mord mtight" style="color:red;"><span class="mord mathnormal mtight" style="margin-right:0.03148em;color:red;">k</span></span></span></span></span></span></span></span></span><span class="mspace" style="color:red;margin-right:0.2222222222222222em;"></span><span class="mbin" style="color:red;">−</span><span class="mspace" style="color:red;margin-right:0.2222222222222222em;"></span><span class="mord" style="color:red;">1</span><span class="mord cjk_fallback" style="color:red;">，</span><span class="mord cjk_fallback" style="color:red;">接</span><span class="mord cjk_fallback" style="color:red;">收</span><span class="mord cjk_fallback" style="color:red;">端</span><span class="mspace" style="color:red;margin-right:0.2777777777777778em;"></span><span class="mrel" style="color:red;">=</span><span class="mspace" style="color:red;margin-right:0.2777777777777778em;"></span><span class="mord" style="color:red;">1</span></span></span></span></span></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191437793.png" alt=""></p>
<h3 id="选择重传sr"><a class="markdownIt-Anchor" href="#选择重传sr">#</a> 选择重传（SR）</h3>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191444933.png" alt=""></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191448175.png" alt=""></p>
<p><strong>发送方</strong>：</p>
<ol>
<li>从上层收到数据：如果下一个可用于该分组的序号在窗口内，则将数据打包并发送。</li>
<li>超时（n）：为每个分组定义定时器；重传分组 n，重置定时器</li>
<li>收到确认（n）在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mo separator="true">,</mo><mi>s</mi><mi>e</mi><mi>n</mi><mi>d</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mo>+</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[sendbase,sendbase+N-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">b</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mord mathnormal">b</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 范围内：标记分组 n 为已接收，如果 n 是发送方窗口基序号 sendbase，则将窗口基序号推到下一个未确认序号</li>
</ol>
<p><strong>接收方</strong>：</p>
<ol>
<li>分组序号 n 在<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false">[</mo><mi>r</mi><mi>c</mi><mi>v</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mo separator="true">,</mo><mi>r</mi><mi>c</mi><mi>v</mi><mi>b</mi><mi>a</mi><mi>s</mi><mi>e</mi><mo>+</mo><mi>N</mi><mo>−</mo><mn>1</mn><mo stretchy="false">]</mo></mrow><annotation encoding="application/x-tex">[rcvbase,rcvbase+N-1]</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">[</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">b</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">b</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">e</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mclose">]</span></span></span></span> 范围内
<ul>
<li>发送 n 的确认 ACK（n）</li>
<li>如果分组序号失序，将其缓存</li>
<li>按序分组：将该分组以及以前的缓存的序号连续的分组一起交付给上层，将窗口前推到下一个未收到的分组。</li>
<li>再次发送 n 的确认 ACK</li>
</ul>
</li>
<li>其他情况，忽略该分组</li>
</ol>
<p>接收方窗口 **<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≤</mo><msup><mn>2</mn><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\leq 2^{k-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7719400000000001em;vertical-align:-0.13597em;"></span><span class="mrel">≤</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8491079999999999em;vertical-align:0em;"></span><span class="mord"><span class="mord">2</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8491079999999999em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.03148em;">k</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span></span></span></span>**，即窗口的长度必须小于等于序号空间大小的一半</p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410120031874.png" alt=""></p>
<h1 id="面向连接的运输tcp"><a class="markdownIt-Anchor" href="#面向连接的运输tcp">#</a> 面向连接的运输：TCP</h1>
<h2 id="tcp的特点"><a class="markdownIt-Anchor" href="#tcp的特点">#</a> TCP 的特点</h2>
<p><strong>面向连接</strong>：必须相互发送某些预备报文段，以建立确保数据传输的参数。</p>
<p><strong>全双工服务</strong>：可双向同时传输数据。</p>
<p><strong>点对点连接</strong>：仅能存在于两个端系统之间。</p>
<p><strong>三次握手</strong>：客户端先发送一个特殊的 TCP 报文段，服务器用一个特殊的报文段进行响应，这两个报文段都不含应用层数据；最后客户端用第三个特殊报文段作为响应，第三个报文段可以承载有效数据。</p>
<p><strong>可靠的字节流</strong>：TCP 可以从缓存中取出并放入报文段中的数据数量受限于最大报文段长度 MSS，MSS 由本地发送主机发送的最大链路层帧长度【即最大运输单元 MTU】设置。MSS 要保证加上 TCP/IP 首部长度（通常是 40 字节）将适合单个链路层帧。</p>
<p>注意：MSS 是指报文段中<strong>应用层数据的最大长度</strong>，而<strong>不是</strong>指包括首部的 TCP 报文段的最大长度。</p>
<h2 id="tcp报文段结构"><a class="markdownIt-Anchor" href="#tcp报文段结构">#</a> TCP 报文段结构</h2>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410141051586.png" alt=""></p>
<p><strong>源端口和目的端口</strong>：各占 2 字节，端口是应用层和运输层的服务端口。运输层的复用和分解都需要通过端口实现。</p>
<p><strong>序号</strong>：占 4 字节，TCP 连接中传输的数据流的每一个字节都有一个序号，序号字段的值指的是本报文段所发送的数据的第一个字节在整个报文字节流中的序号。</p>
<p><strong>确认号</strong>：占 4 字节，是期望收到对方的下一个报文段的数据段的第一个字节的序号。</p>
<p><strong>首部长度</strong>：占 4bit，该字段指示了以 32bit 的字为单位的 TCP 首部长度。（通常选项字段为空，TCP 首部典型长度是 20 字节）</p>
<p><strong>保留字段</strong>：占 6bit，保留为今后使用，但目前应置为 0。</p>
<p><strong>URG</strong>：紧急比特，UGR=1 表明此报文段中有紧急数据，应尽快送达。</p>
<p><strong>ACK</strong>：确认 ACK，只有当 ACK=1 时确认号字段才有效；ACK=0 时，确认号无效。</p>
<p><strong>PSH</strong>：接收到 PSH=1 的报文段，就尽快交付给接收应用进程，而不再等到整个缓存都填满再向上交付。</p>
<p><strong>RST</strong>：当 RST=1 时，表名 TCP 连接中出现严重差错，必须释放连接，然后再重新建立运输链接。</p>
<p><strong>SYN</strong>：同步比特，SYN=1，这是一个连接请求或连接接收的报文。</p>
<p><strong>FIN</strong>：释放一个链接，当 FIN=1，此报文段的发送端的数据已经发送完毕，并要求释放运输链接。</p>
<p><strong>窗口</strong>：占 2 字节，窗口字段用来控制对方发送的数据量，单位为字节。</p>
<p><strong>检验和</strong>：占 2 字节，检验范围包括首部和数据两部分，计算时要在 TCP 报文段的前面加上 12 字节的伪首部。</p>
<p><strong>紧急指针</strong>：占 2 字节，指出本报文段中紧急数据的最后一个字节的序号。</p>
<p><strong>填充</strong>：为了使整个首部的长度是 4 字节的整数倍。</p>
<h2 id="估计往返时间rtt"><a class="markdownIt-Anchor" href="#估计往返时间rtt">#</a> 估计往返时间 RTT</h2>
<p>在任意时刻，仅为一个已发送但目前尚未被确定的报文段估计 SampleRTT，从而产生一个接近每个 RTT 的新的 SampleRTT。</p>
<p>TCP 不为已被重传的报文段计算 SampleRTT。</p>
<p>因为 RTT 有波动，所以利用加权平均值计算 EstimatedRTT</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>=</mo><mn>0.875</mn><mo>∗</mo><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mn>0.125</mn><mo>∗</mo><mi>S</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">EstimatedRTT=0.875*EstimatedRTT+0.125*SampleRTT
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">8</span><span class="mord">7</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">1</span><span class="mord">2</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span></span></p>
<p>估算 SampleRTT 偏离 EstimatedRTT 的程度：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>=</mo><mo stretchy="false">(</mo><mn>1</mn><mo>−</mo><mi>β</mi><mo stretchy="false">)</mo><mo>⋅</mo><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mi>β</mi><mo>⋅</mo><mi mathvariant="normal">∣</mi><mi>S</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>−</mo><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mi mathvariant="normal">∣</mi><mo separator="true">,</mo><mi>β</mi><mtext>推荐值为</mtext><mn>0.25</mn></mrow><annotation encoding="application/x-tex">DevRTT=(1-\beta)\cdot DevRTT+\beta\cdot|SampleRTT-EstimatedRTT|,\beta推荐值为0.25
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">∣</span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord">∣</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal" style="margin-right:0.05278em;">β</span><span class="mord cjk_fallback">推</span><span class="mord cjk_fallback">荐</span><span class="mord cjk_fallback">值</span><span class="mord cjk_fallback">为</span><span class="mord">0</span><span class="mord">.</span><span class="mord">2</span><span class="mord">5</span></span></span></span></span></p>
<p>第一次计算时<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>=</mo><mn>0.5</mn><mo>∗</mo><mi>S</mi><mi>a</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">DevRTT=0.5*SampleRTT</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">0</span><span class="mord">.</span><span class="mord">5</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">S</span><span class="mord mathnormal">a</span><span class="mord mathnormal">m</span><span class="mord mathnormal">p</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span></p>
<p>TCP 中确定重传超时间隔的方法：</p>
<p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>=</mo><mi>E</mi><mi>s</mi><mi>t</mi><mi>i</mi><mi>m</mi><mi>a</mi><mi>t</mi><mi>e</mi><mi>d</mi><mi>R</mi><mi>T</mi><mi>T</mi><mo>+</mo><mn>4</mn><mo>⋅</mo><mi>D</mi><mi>e</mi><mi>v</mi><mi>R</mi><mi>T</mi><mi>T</mi></mrow><annotation encoding="application/x-tex">TimeoutInterval=EstimatedRTT+4\cdot DevRTT
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.77777em;vertical-align:-0.08333em;"></span><span class="mord mathnormal" style="margin-right:0.05764em;">E</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">d</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">D</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span></span></span></span></span></p>
<p>推荐初始的<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>T</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>o</mi><mi>u</mi><mi>t</mi><mi>I</mi><mi>n</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>v</mi><mi>a</mi><mi>l</mi><mo>=</mo><mn>1</mn><mi>s</mi></mrow><annotation encoding="application/x-tex">TimeoutInterval = 1s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal">i</span><span class="mord mathnormal">m</span><span class="mord mathnormal">e</span><span class="mord mathnormal">o</span><span class="mord mathnormal">u</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.07847em;">I</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span><span class="mord mathnormal">s</span></span></span></span></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191411344.png" alt=""></p>
<p>出现超时 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>T</mi><mi>O</mi><mo>∗</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">RTO*2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal" style="margin-right:0.13889em;">T</span><span class="mord mathnormal" style="margin-right:0.02778em;">O</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">2</span></span></span></span></p>
<h2 id="可靠数据传输"><a class="markdownIt-Anchor" href="#可靠数据传输">#</a> 可靠数据传输</h2>
<p>TCP 使用<strong>单一定时器</strong>。</p>
<p>从上面应用程序收到数据 e：如果当前定时器没有运行，启动定时器并向 IP 传递报文段。</p>
<p>定时器超时：重传具有最小序号但仍未应答的报文段并启动定时器。</p>
<p>收到 ACK，具有 ACK 字段值 y：如果 <code>y &gt; SendBase</code> ，重置 <code>Sendbase = y</code> ，如果仍有尚未确认的报文段，启动定时器。</p>
<p>（SendBase 是最早未被确认的字节的序号，SendBase - 1 是指接收方已正确按序接收到的数据的最后一个字节的序号）</p>
<p><strong>超时间隔加倍</strong>：每次超时时间发生，TCP 重传时都会将下一次的超时时间间隔设为先前的两倍。</p>
<p><strong>快速重传</strong>：当 TCP 接收方检测到了数据流中的一个间隔，就会不断重发它期望的这个 ACK，当冗余 ACK 的数量达到 3 的时候，就采用快速重传机制，在超时之前就重传该分组。</p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/PictureBed/master/img/202410141803966.png" alt=""></p>
<h2 id="流量控制"><a class="markdownIt-Anchor" href="#流量控制">#</a> 流量控制</h2>
<p>接收方在反馈时，将缓冲区剩余空间的大小填充在报文段首部的窗口字段中，通知发送方</p>
<p>主机 A 向主机 B 发送文件，主机 B 接收缓存的大小是 RcvBuffer；主机 B 上的应用进程从缓存读出的数据流的最后一个字节的编号是 LastByteRead；从网络中到达的并且已放入主机 B 接收缓存中的数据流的最后一个字节的编号。</p>
<p>接收窗口的大小：<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mi>w</mi><mi>n</mi><mi>d</mi><mo>=</mo><mi>R</mi><mi>c</mi><mi>v</mi><mi>B</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>e</mi><mi>r</mi><mo>−</mo><mo stretchy="false">(</mo><mi>L</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>a</mi><mi>d</mi><mo>−</mo><mi>L</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>B</mi><mi>y</mi><mi>t</mi><mi>e</mi><mi>R</mi><mi>e</mi><mi>a</mi><mi>d</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">rwnd = RcvBuffer - (LastByteRead - LastByteRead)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.69444em;vertical-align:0em;"></span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mord mathnormal" style="margin-right:0.02691em;">w</span><span class="mord mathnormal">n</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">c</span><span class="mord mathnormal" style="margin-right:0.03588em;">v</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal" style="margin-right:0.10764em;">f</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.02778em;">r</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">L</span><span class="mord mathnormal">a</span><span class="mord mathnormal">s</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:0.05017em;">B</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:0.00773em;">R</span><span class="mord mathnormal">e</span><span class="mord mathnormal">a</span><span class="mord mathnormal">d</span><span class="mclose">)</span></span></span></span></p>
<p>为让发送方在接收方的缓存满了之后可以及时了解什么时候又有新的空间，发送方持续向接收方发送只有<strong>一字节</strong>数据的报文段。</p>
<h2 id="tcp连接管理"><a class="markdownIt-Anchor" href="#tcp连接管理">#</a> TCP 连接管理</h2>
<p>3 次握手，4 次分手</p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191517080.png" alt=""></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191509839.png" alt=""></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191514191.png" alt=""></p>
<h1 id="拥塞控制协议"><a class="markdownIt-Anchor" href="#拥塞控制协议">#</a> 拥塞控制协议</h1>
<p><strong>拥塞控制方法</strong>：</p>
<p><strong>网络辅助的拥塞控制</strong></p>
<ul>
<li>
<p>直接网络反馈：<strong>路由器</strong>以阻塞分组的形式通知发送方 “网络拥塞了”</p>
</li>
<li>
<p>经由接收方的网络反馈：路由器标识从发送方流向接收方分组中的某个字段以指示拥塞的产生，由<strong>接收方</strong>通知发送方 “网络拥塞了”（至少要经过一个完整的往返时间）</p>
</li>
</ul>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202410181313027.jpg" alt=""></p>
<p><strong>端到端拥塞控制</strong></p>
<ul>
<li>
<p>网络层不为拥塞控制提供任何帮助和支持</p>
</li>
<li>
<p>端系统通过对网络行为（丢包或时延增加）的观测判断网络是否发生拥塞</p>
</li>
<li>
<p>目前 TCP 采用该种方法（通过三个冗余的 ACK 实现）</p>
</li>
</ul>
<h1 id="tcp拥塞控制"><a class="markdownIt-Anchor" href="#tcp拥塞控制">#</a> TCP 拥塞控制</h1>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202411191357221.png" alt=""></p>
<h2 id="reno算法"><a class="markdownIt-Anchor" href="#reno算法">#</a> Reno 算法</h2>
<p><strong>加性增，乘性减（AIMD）</strong></p>
<ol>
<li>
<p>出现丢包事件后将当前 CongWin 大小<strong>减半</strong>，可以大大减少注入到网络中的分组数</p>
</li>
<li>
<p>当<strong>没有丢包</strong>事件发生了，每个 RTT 之后将 CongWin<strong> 增大 1 个 MSS</strong>，使拥塞窗口缓慢增大，以防止网络过早出现拥塞</p>
</li>
</ol>
<h3 id="慢启动和拥塞避免"><a class="markdownIt-Anchor" href="#慢启动和拥塞避免">#</a> 慢启动和拥塞避免</h3>
<p><strong>建立连接时，CongWin = 1 MSS</strong></p>
<p>eg：</p>
<ol>
<li><strong>MSS（最大报文段大小）</strong> = 500 字节</li>
<li><strong>CongWin</strong> = 1 MSS = 500 字节 = 500 * 8 比特</li>
<li><strong>RTT</strong> = 200 毫秒</li>
</ol>
<p>所以<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>初始速率</mtext><mo>=</mo><mfrac><mrow><mn>500</mn><mo>∗</mo><mn>8</mn></mrow><mn>200</mn></mfrac><mo>=</mo><mn>20</mn><mi>k</mi><mi>b</mi><mi>p</mi><mi>s</mi></mrow><annotation encoding="application/x-tex">初始速率=\frac{500 * 8}{200}=20kbps</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord cjk_fallback">初</span><span class="mord cjk_fallback">始</span><span class="mord cjk_fallback">速</span><span class="mord cjk_fallback">率</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.190108em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.845108em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span><span class="mord mtight">0</span><span class="mord mtight">0</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">5</span><span class="mord mtight">0</span><span class="mord mtight">0</span><span class="mbin mtight">∗</span><span class="mord mtight">8</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord">2</span><span class="mord">0</span><span class="mord mathnormal" style="margin-right:0.03148em;">k</span><span class="mord mathnormal">b</span><span class="mord mathnormal">p</span><span class="mord mathnormal">s</span></span></span></span></p>
<p><strong>可用带宽 &gt;&gt; MSS/RTT</strong></p>
<ul>
<li>
<p>初始阶段以指数的速度增加发送速率</p>
</li>
<li>
<p>连接初始阶段，以<strong>指数的速度</strong>增加发送速率，直到发生一个丢包事件为止</p>
</li>
<li>
<p>每收到一次确认则将 CongWin 的值<strong>增加一个 MSS</strong></p>
</li>
</ul>
<img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202410181412990.png" style="zoom: 50%;" />
<p>对收到<strong> 3 个重复 ACK</strong> 的反应</p>
<ul>
<li>
<p>将<strong> CongWin 减</strong>为原来的<strong>一半</strong></p>
</li>
<li>
<p><strong>线性增大</strong>拥塞窗口</p>
</li>
</ul>
<p>对<strong>超时</strong>事件的反应</p>
<ul>
<li>
<p><strong>门限值</strong>设为当前 CongWin 的<strong>一半</strong>（门限值初始值 65kB）</p>
</li>
<li>
<p>将<strong> CongWin</strong> 设为<strong> 1 个 MSS</strong> 大小；</p>
</li>
<li>
<p>窗口以<strong>指数</strong>速度增大</p>
</li>
<li>
<p>窗口增大到<strong>门限值</strong>之后，再以<strong>线性</strong>速度增大</p>
</li>
</ul>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202410181421162.png" alt=""></p>
<ol>
<li>当 TCP 连接进行初始化时，将<strong>拥塞窗口置为 1</strong>。图中的窗口单位不使用字节而使用<strong>报文段</strong>。慢开始门限的初始值设置为 16 个报文段，即 ssthresh = 16。</li>
<li>发送端的发送窗口不能超过<strong>拥塞窗口 cwnd</strong> 和<strong>接收端窗口 rwnd</strong> 中的<strong>最小值</strong>。我们假定接收端窗口足够大，因此现在发送窗口的数值等于拥塞窗口的数值。</li>
<li>当拥塞窗口 cwnd 增长到<strong>慢开始门限值 ssthresh</strong> 时（即当 cwnd = 16 时），就改为执行<strong>拥塞避免算法</strong>，拥塞窗口按<strong>线性规律</strong>增长。</li>
</ol>
<h3 id="快速恢复"><a class="markdownIt-Anchor" href="#快速恢复">#</a> 快速恢复</h3>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202410181425437.png" alt=""></p>
<ul>
<li>
<p>3 个冗余 ACK 进入快速重传后</p>
</li>
<li>
<p>每收到一个<strong>冗余</strong> ACK：<strong>CongWin++</strong></p>
</li>
<li>
<p>直至收到一个<strong>新的</strong> ACK：<strong>CongWin = 门限值</strong>，重新进入拥塞避免；因为已经收到了三个冗余 ACK，所以实际 cwnd = 门限值 + 3</p>
</li>
<li>
<p>在进入<strong>快速恢复之后</strong>及重新<strong>进入拥塞避免之间</strong>，如果出现<strong>超时</strong>现象，直接<strong>按</strong>照前述<strong>超时事件</strong>进行<strong>处理</strong></p>
</li>
</ul>
<p><strong>总结</strong></p>
<p><img data-src="https://raw.githubusercontent.com/LUCKYCYYYY/WEb_img2/main/img/202410181430514.png" alt=""></p>
<h2 id="tcp吞吐量"><a class="markdownIt-Anchor" href="#tcp吞吐量">#</a> TCP 吞吐量</h2>
<p>假定当丢包事件发生时，窗口大小为 W，此时吞吐量为 W/RTT</p>
<p>丢包事件发生后，窗口大小减为 W/2, 吞吐量为 W/2RTT，因此平均吞吐量为: 0.75 W/RTT</p>
<p>吞吐量是丢包率 (L) 的函数:<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mrow><mn>1.22</mn><mo>⋅</mo><mi>M</mi><mi>S</mi><mi>S</mi></mrow><mrow><mi>R</mi><mi>T</mi><mi>T</mi><msqrt><mi>L</mi></msqrt></mrow></mfrac></mrow><annotation encoding="application/x-tex">\frac{1.22\cdot MSS}{RTT\sqrt{L}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.410331em;vertical-align:-0.538em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.537397em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord mathnormal mtight" style="margin-right:0.13889em;">T</span><span class="mord sqrt mtight"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.9322900000000001em;"><span class="svg-align" style="top:-3em;"><span class="pstrut" style="height:3em;"></span><span class="mord mtight" style="padding-left:0.833em;"><span class="mord mathnormal mtight">L</span></span></span><span style="top:-2.89229em;"><span class="pstrut" style="height:3em;"></span><span class="hide-tail mtight" style="min-width:0.853em;height:1.08em;"><svg width='400em' height='1.08em' viewBox='0 0 400000 1080' preserveAspectRatio='xMinYMin slice'><path d='M95,702
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l0 -0
c5.3,-9.3,12,-14,20,-14
H400000v40H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M834 80h400000v40h-400000z'/></svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.10770999999999997em;"><span></span></span></span></span></span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">1</span><span class="mord mtight">.</span><span class="mord mtight">2</span><span class="mord mtight">2</span><span class="mbin mtight">⋅</span><span class="mord mathnormal mtight" style="margin-right:0.10903em;">M</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span><span class="mord mathnormal mtight" style="margin-right:0.05764em;">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.538em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></p>
<h2 id="并行tcp连接"><a class="markdownIt-Anchor" href="#并行tcp连接">#</a> 并行 TCP 连接</h2>
<p>考虑一段速率为 R 且支持 9 个在线客户 - 服务器应用的链路，每个应用使用一条 TCP 连接，如果一个新的应用加入进来</p>
<ul>
<li 10="">如果新的应用也使用一条 TCP 连接，则每个应用得到差不多相同的传输速率\frac{R}</li>
<li>如果新的应用使用了 11 个并行的 TCP 连接，那这个应用就会不公平的分到超过<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mi>R</mi><mn>2</mn></mfrac></mrow><annotation encoding="application/x-tex">\frac{R}{2}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.217331em;vertical-align:-0.345em;"></span><span class="mord"><span class="mopen nulldelimiter"></span><span class="mfrac"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.872331em;"><span style="top:-2.6550000000000002em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span><span style="top:-3.23em;"><span class="pstrut" style="height:3em;"></span><span class="frac-line" style="border-bottom-width:0.04em;"></span></span><span style="top:-3.394em;"><span class="pstrut" style="height:3em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.00773em;">R</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.345em;"><span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span> 的带宽</li>
</ul>

      <div class="tags">
          <a href="/tags/%E8%AE%A1%E7%BD%91/" rel="tag"><i class="ic i-tag"></i> 计网</a>
      </div>
  </div>

   <footer>

    <div class="meta">
  <span class="item">
    <span class="icon">
      <i class="ic i-calendar-check"></i>
    </span>
    <span class="text">更新于</span>
    <time title="修改时间：2025-03-18 01:52:04" itemprop="dateModified" datetime="2025-03-18T01:52:04+08:00">2025-03-18</time>
  </span>
</div>

      
<div class="reward">
  <button><i class="ic i-heartbeat"></i> 赞赏</button>
  <p>请我喝[茶]~(￣▽￣)~*</p>
  <div id="qr">
      
      <div>
        <img data-src="/images/wechatpay.png" alt="Aurijun 微信支付">
        <p>微信支付</p>
      </div>
      
      <div>
        <img data-src="/images/alipay.png" alt="Aurijun 支付宝">
        <p>支付宝</p>
      </div>
  </div>
</div>

      

<div id="copyright">
<ul>
  <li class="author">
    <strong>本文作者： </strong>Aurijun <i class="ic i-at"><em>@</em></i>眨眼的小星玥
  </li>
  <li class="link">
    <strong>本文链接：</strong>
    <a href="http://www.luckycyyyy.top/2024/10/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E8%BF%90%E8%BE%93%E5%B1%82/" title="运输层">http://www.luckycyyyy.top/2024/10/11/计算机科学/计算机网络/计网--运输层/</a>
  </li>
  <li class="license">
    <strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

  </footer>

</article>

  </div>
  

<div class="post-nav">
    <div class="item left">
      

  <a href="/2024/10/10/%E7%AB%9E%E8%B5%9B/CMC/CMC%E4%B8%80%E5%85%83%E5%BE%AE%E5%88%86/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s21.ax1x.com&#x2F;2025&#x2F;03&#x2F;25&#x2F;pEDVu28.jpg" title="CMC一元微分">
  <span class="type">上一篇</span>
  <span class="category"><i class="ic i-flag"></i> CMC</span>
  <h3>CMC一元微分</h3>
  </a>

    </div>
    <div class="item right">
      

  <a href="/2024/10/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E5%BA%94%E7%94%A8%E5%B1%82/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;haowallpaper.com&#x2F;link&#x2F;common&#x2F;file&#x2F;previewFileImg&#x2F;16540905014545792" title="应用层">
  <span class="type">下一篇</span>
  <span class="category"><i class="ic i-flag"></i> 计算机网络</span>
  <h3>应用层</h3>
  </a>

    </div>
</div>

  
  <div class="wrap" id="comments"></div>


        </div>
        <div id="sidebar">
          

<div class="inner">

  <div class="panels">
    <div class="inner">
      <div class="contents panel pjax" data-title="文章目录">
          <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0%E8%BF%90%E8%BE%93%E5%B1%82%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text"> 概述运输层服务</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82%E5%92%8C%E7%BD%91%E7%BB%9C%E5%B1%82%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.</span> <span class="toc-text"> 运输层和网络层的关系</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%BE%93%E5%B1%82%E6%A6%82%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text"> 运输层概述</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8E%E5%A4%9A%E8%B7%AF%E5%88%86%E8%A7%A3"><span class="toc-number">2.</span> <span class="toc-text"> 多路复用与多路分解</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#udp%E5%92%8Ctcp%E5%AF%B9%E6%AF%94"><span class="toc-number">3.</span> <span class="toc-text"> UDP 和 TCP 对比</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%97%A0%E8%BF%9E%E6%8E%A5%E8%BF%90%E8%BE%93udp"><span class="toc-number">4.</span> <span class="toc-text"> 无连接运输：UDP</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%8E%9F%E7%90%86"><span class="toc-number">5.</span> <span class="toc-text"> 可靠数据传输原理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%AE%8C%E5%85%A8%E5%8F%AF%E9%9D%A0%E7%9A%84%E4%BF%A1%E9%81%93%E7%9A%84%E5%8F%AF%E9%9D%A0%E4%BF%A1%E6%81%AF%E4%BC%A0%E8%BE%93rdt10"><span class="toc-number">5.1.</span> <span class="toc-text"> 经完全可靠的信道的可靠信息传输：rdt1.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B7%E6%9C%89%E6%AF%94%E7%89%B9%E5%B7%AE%E9%94%99%E4%BF%A1%E9%81%93%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93rdt2x"><span class="toc-number">5.2.</span> <span class="toc-text"> 经具有比特差错信道的可靠数据传输：rdt2.x</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#20-%E5%8F%91%E9%80%81%E7%9A%84%E6%95%B0%E6%8D%AE%E5%8F%97%E6%8D%9F"><span class="toc-number">5.2.1.</span> <span class="toc-text"> 2.0 发送的数据受损</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#21-acknak%E5%8F%97%E6%8D%9F"><span class="toc-number">5.2.2.</span> <span class="toc-text"> 2.1 ACK&#x2F;NAK 受损</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#22-%E4%BD%BF%E7%94%A8%E4%B8%80%E4%B8%AA%E6%97%A0nak%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.2.3.</span> <span class="toc-text"> 2.2 使用一个无 NAK 的可靠数据传输协议</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%8F%E5%85%B7%E6%9C%89%E6%AF%94%E7%89%B9%E5%B7%AE%E9%94%99%E7%9A%84%E4%B8%A2%E5%8C%85%E4%BF%A1%E9%81%93%E7%9A%84%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93rdt30"><span class="toc-number">5.3.</span> <span class="toc-text"> 经具有比特差错的丢包信道的可靠数据传输：rdt3.0</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="toc-number">5.4.</span> <span class="toc-text"> 流水线可靠数据传输协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9B%9E%E9%80%80n%E6%AD%A5%E5%8D%8F%E8%AE%AEgbn"><span class="toc-number">5.4.1.</span> <span class="toc-text"> 回退 N 步协议（GBN）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9%E9%87%8D%E4%BC%A0sr"><span class="toc-number">5.4.2.</span> <span class="toc-text"> 选择重传（SR）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%9D%A2%E5%90%91%E8%BF%9E%E6%8E%A5%E7%9A%84%E8%BF%90%E8%BE%93tcp"><span class="toc-number">6.</span> <span class="toc-text"> 面向连接的运输：TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E7%9A%84%E7%89%B9%E7%82%B9"><span class="toc-number">6.1.</span> <span class="toc-text"> TCP 的特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E6%8A%A5%E6%96%87%E6%AE%B5%E7%BB%93%E6%9E%84"><span class="toc-number">6.2.</span> <span class="toc-text"> TCP 报文段结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%B0%E8%AE%A1%E5%BE%80%E8%BF%94%E6%97%B6%E9%97%B4rtt"><span class="toc-number">6.3.</span> <span class="toc-text"> 估计往返时间 RTT</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%AF%E9%9D%A0%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93"><span class="toc-number">6.4.</span> <span class="toc-text"> 可靠数据传输</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="toc-number">6.5.</span> <span class="toc-text"> 流量控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E8%BF%9E%E6%8E%A5%E7%AE%A1%E7%90%86"><span class="toc-number">6.6.</span> <span class="toc-text"> TCP 连接管理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE"><span class="toc-number">7.</span> <span class="toc-text"> 拥塞控制协议</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tcp%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="toc-number">8.</span> <span class="toc-text"> TCP 拥塞控制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#reno%E7%AE%97%E6%B3%95"><span class="toc-number">8.1.</span> <span class="toc-text"> Reno 算法</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%85%A2%E5%90%AF%E5%8A%A8%E5%92%8C%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D"><span class="toc-number">8.1.1.</span> <span class="toc-text"> 慢启动和拥塞避免</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D"><span class="toc-number">8.1.2.</span> <span class="toc-text"> 快速恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tcp%E5%90%9E%E5%90%90%E9%87%8F"><span class="toc-number">8.2.</span> <span class="toc-text"> TCP 吞吐量</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8Ctcp%E8%BF%9E%E6%8E%A5"><span class="toc-number">8.3.</span> <span class="toc-text"> 并行 TCP 连接</span></a></li></ol></li></ol>
      </div>
      <div class="related panel pjax" data-title="系列文章">
        <ul>
          <li><a href="/2024/09/24/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C%E5%92%8C%E5%9B%A0%E7%89%B9%E7%BD%91/" rel="bookmark" title="计算机网络和因特网">计算机网络和因特网</a></li><li class="active"><a href="/2024/10/11/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E8%BF%90%E8%BE%93%E5%B1%82/" rel="bookmark" title="运输层">运输层</a></li><li><a href="/2024/10/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E5%BA%94%E7%94%A8%E5%B1%82/" rel="bookmark" title="应用层">应用层</a></li><li><a href="/2024/11/13/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E7%BD%91%E7%BB%9C%E5%B1%82/" rel="bookmark" title="网络层">网络层</a></li><li><a href="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E9%93%BE%E8%B7%AF%E5%B1%82/" rel="bookmark" title="链路层">链路层</a></li>
        </ul>
      </div>
      <div class="overview panel" data-title="站点概览">
        <div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="image" itemprop="image" alt="Aurijun"
      data-src="/images/cyy.png">
  <p class="name" itemprop="name">Aurijun</p>
  <div class="description" itemprop="description">小星玥，要努力学习呀！</div>
</div>

<nav class="state">
    <div class="item posts">
      <a href="/archives/">
        <span class="count">111</span>
        <span class="name">文章</span>
      </a>
    </div>
    <div class="item categories">
      <a href="/categories/">
        <span class="count">34</span>
        <span class="name">分类</span>
      </a>
    </div>
    <div class="item tags">
      <a href="/tags/">
        <span class="count">59</span>
        <span class="name">标签</span>
      </a>
    </div>
</nav>

<div class="social">
      <span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL0xVQ0tZQ1lZWVk=" title="https:&#x2F;&#x2F;github.com&#x2F;LUCKYCYYYY"><i class="ic i-github"></i></span>
</div>

<ul class="menu">
  
    
  <li class="item">
    <a href="/" rel="section"><i class="ic i-home"></i>首页</a>
  </li>

    
  <li class="item">
    <a href="/about/" rel="section"><i class="ic i-user"></i>关于</a>
  </li>

        
  <li class="item dropdown">
      <a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a>
    <ul class="submenu">

        
  <li class="item">
    <a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a>
  </li>

        
  <li class="item">
    <a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a>
  </li>

        
  <li class="item">
    <a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a>
  </li>

  </ul>
    
  <li class="item">
    <a href="/links/" rel="section"><i class="ic i-magic"></i>网站</a>
  </li>


</ul>

      </div>
    </div>
  </div>

  <ul id="quick">
    <li class="prev pjax">
        <a href="/2024/10/10/%E7%AB%9E%E8%B5%9B/CMC/CMC%E4%B8%80%E5%85%83%E5%BE%AE%E5%88%86/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a>
    </li>
    <li class="up"><i class="ic i-arrow-up"></i></li>
    <li class="down"><i class="ic i-arrow-down"></i></li>
    <li class="next pjax">
        <a href="/2024/10/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E8%AE%A1%E7%BD%91--%E5%BA%94%E7%94%A8%E5%B1%82/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a>
    </li>
    <li class="percent"></li>
  </ul>
</div>


        </div>
        <div class="dimmer"></div>
      </div>
    </main>
    <footer id="footer">
      <div class="inner">
        <div class="widgets">
          

        </div>
        <div class="status">
  <div class="copyright">
    
    &copy; 2023 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="ic i-sakura rotate"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Aurijun @ Aurijun</span>
  </div>
  <div class="count">
    <span class="post-meta-item-icon">
      <i class="ic i-chart-area"></i>
    </span>
    <span title="站点总字数">667k 字</span>

    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="ic i-coffee"></i>
    </span>
    <span title="站点阅读时长">10:07</span>
  </div>
  <div class="powered-by">
    基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span>
  </div>
</div>

      </div>
    </footer>
  </div>
<script data-config type="text/javascript">
  var LOCAL = {
    path: '2024/10/11/计算机科学/计算机网络/计网--运输层/',
    favicon: {
      show: "嘿嘿好久不见(*¯︶¯*)",
      hide: "哎呀~走掉惹"
    },
    search : {
      placeholder: "文章搜索",
      empty: "关于 「 ${query} 」，什么也没搜到",
      stats: "${time} ms 内找到 ${hits} 条结果"
    },
    valine: true,copy_tex: true,
    katex: true,fancybox: true,
    copyright: '复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',
    ignores : [
      function(uri) {
        return uri.includes('#');
      },
      function(uri) {
        return new RegExp(LOCAL.path+"$").test(uri);
      }
    ]
  };
</script>

<script src="https://cdn.polyfill.io/v2/polyfill.js"></script>

<script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script>

<script src="/js/app.js?v=0.2.5"></script>




</body>
</html>
